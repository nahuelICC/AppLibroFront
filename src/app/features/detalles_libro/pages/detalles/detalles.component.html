<!-- Primer Div: Informaci√≥n del Libro y Detalle de Precio -->
<div class="flex flex-col md:flex-row gap-6 p-6 mt-10 min-h-screen">
  <!-- üìñ Secci√≥n Izquierda: Informaci√≥n del Libro -->
  <div class="md:w-2/3 pl-6 flex flex-col">
    <p class="text-gray-500 mb-4">{{ libro?.genero }}</p>
    <!-- T√≠tulo y Autor -->
    <h1 class="text-2xl font-bold">{{ libro?.titulo }}</h1>
    <p class="text-gray-500 text-lg mt-2">{{ libro?.autor }}</p>

    <!-- Contenedor de la imagen y la descripci√≥n -->
    <div class="flex flex-col md:flex-row gap-6">
      <!-- Imagen de la Portada -->
      <img [src]="libro?.portada || 'assets/default-cover.jpg'" alt="Portada del libro"
           class="w-full max-w-xs mt-4 shadow-md rounded-lg">

      <!-- üìÑ Descripci√≥n del Libro -->
      <div>
        <h2 class="text-xl font-semibold mt-10">Sinopsis</h2>
        <p class="text-gray-700">{{ libro?.descripcion }}</p>
      </div>
    </div>
  </div>

  <!-- üí∞ Secci√≥n Derecha: Precio y detalles de compra -->
  <div class="md:w-1/3 p-6 flex flex-col">
    <app-detalle-precio
      *ngIf="libro"
      [precios]="{
                    blanda: libro?.precioTapaBlanda ? +libro.precioTapaBlanda : null,
                    dura: libro?.precioTapaDura ? +libro.precioTapaDura : null
                }"
      [tiposTapa]="tiposTapa"
      [libroId]="libroId">
    </app-detalle-precio>
  </div>
</div>

<!-- Segundo Div: Rese√±as -->
<div class="pl-16 pr-12">
  <!-- Barra de Rese√±as -->
  <div class="mb-6">
    <h2 class="text-xl font-semibold">Rese√±as</h2>

    <!-- ‚≠ê Puntuaci√≥n promedio -->
    <div class="mt-4 flex items-center justify-between w-3/5">
      <div class="flex items-center flex-wrap">
        <h3 class="text-3xl font-bold mr-2">{{ averageRating }}</h3>
        <div class="flex">
          <ng-container *ngFor="let star of starsArray">
            <span class="text-2xl" [class]="star <= averageRating ? 'text-black' : 'text-gray-400'">‚òÖ</span>
          </ng-container>
        </div>
      </div>
      <p class="text-gray-500">{{ totalReviews }} rese√±as</p>
    </div>

    <!-- üìä Barra de distribuci√≥n de estrellas -->
    <div class="mt-4 mb-4 space-y-1">
      <div *ngFor="let rating of ratingDistribution; let i = index" class="flex items-center justify-between">
        <div class="flex items-center w-3/5">
          <span class="w-6 text-center mr-2">{{ rating.stars }}</span>
          <div class="flex-1 bg-gray-200 rounded-full h-2 relative">
            <div class="bg-black h-2 rounded-full absolute top-0 left-0" [style.width.%]="rating.percentage"></div>
          </div>
          <span class="ml-2 text-sm">{{ rating.percentage }}%</span>
        </div>
      </div>
    </div>

    <app-boton [label]="'Dejar rese√±a'" [color]="'#078080'" size="small" (click)="toggleFormulario()"></app-boton>
    <div *ngIf="mostrarFormulario" class="mt-4">
      <h3 class="text-lg font-semibold">Escribe tu opini√≥n</h3>
      <form (ngSubmit)="submitReview()" class="mt-4">
        <textarea [(ngModel)]="nuevaResenya.texto" name="texto" placeholder="Escribe tu opini√≥n..."
                  class="w-3/5 p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">

        </textarea>
        <div class="flex items-center mt-4 mb-4">
          <label class="text-lg pr-2 font-semibold">Valoraci√≥n</label>
          <span class="text-2xl" *ngFor="let num of starsArray"
                (click)="nuevaResenya.valoracion = num"
                [class]="nuevaResenya.valoracion >= num ? 'text-black cursor-pointer' : 'text-gray-400 cursor-pointer'">
              ‚òÖ
          </span>
        </div>
        <app-boton [label]="'Enviar Rese√±a'" [color]="'#078080'" size="small"></app-boton>
      </form>
    </div>
  </div>

  <!-- üìù Lista de Rese√±as -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-10 mb-8">
    <app-resena *ngFor="let review of paginatedResenyas"
                [nombre]="review.nombre"
                [apellido]="review.apellido"
                [date]="review.fecha"
                [rating]="review.valoracion"
                [comment]="review.texto"
                [id]="review.id"
                (resenyaDeleted)="onResenyaDeleted()">
    </app-resena>

  </div>

  <!-- Paginaci√≥n -->
  <div class="flex justify-center mt-6">
    <button (click)="previousPage()" [disabled]="currentPage === 1"
            class="px-3 py-1 rounded-lg text-[#111818] hover:bg-[#f0f5f5] disabled:opacity-50 disabled:cursor-not-allowed">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <div class="flex items-center gap-1">
      <ng-container *ngFor="let page of displayedPages">
        <button *ngIf="page !== '...'" (click)="setPage(page)"
                [class.bg-[#f0f5f5]]="currentPage === page"
                class="w-8 h-8 rounded-full flex items-center justify-center text-sm hover:bg-[#f0f5f5] transition-colors"
                [class.font-bold]="currentPage === page">
          {{ page }}
        </button>
        <span *ngIf="page === '...'" class="px-2">...</span>
      </ng-container>
    </div>

    <button (click)="nextPage()" [disabled]="currentPage === totalPages"
            class="px-3 py-1 rounded-lg text-[#111818] hover:bg-[#f0f5f5] disabled:opacity-50 disabled:cursor-not-allowed">
      <mat-icon>arrow_forward</mat-icon>
    </button>
  </div>


</div>
